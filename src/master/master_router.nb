(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     17832,        378]
NotebookOptionsPosition[     16660,        350]
NotebookOutlinePosition[     17023,        366]
CellTagsIndexPosition[     16980,        363]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{
  RowBox[{"DeleteCloudExpression", "/@", 
   RowBox[{"CloudExpressions", "[", "All", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.8134450271445923`*^9, 3.813445030957405*^9}, {
   3.8134463910104237`*^9, 3.8134463918187113`*^9}, {3.813448960035081*^9, 
   3.813448997491995*^9}, {3.813451946484302*^9, 3.813451947487727*^9}, {
   3.813452193772599*^9, 3.813452198599575*^9}, 3.8134532531961718`*^9},
 CellLabel->
  "In[179]:=",ExpressionUUID->"e0937394-699c-4498-bd3b-9fc90a0741b8"],

Cell[CellGroupData[{

Cell[BoxData["$UserURLBase"], "Input",
 CellLabel->
  "In[124]:=",ExpressionUUID->"4c406e40-5f01-4950-b1b8-727b8b2215e7"],

Cell[BoxData["\<\"hernan.fg96\"\>"], "Output",
 CellChangeTimes->{
  3.813439083315359*^9, 3.813440372730702*^9, 3.8134443171093693`*^9, {
   3.81344465028587*^9, 3.813444652314826*^9}, 3.814003158087219*^9, 
   3.814003813827067*^9, 3.814007681631754*^9},
 CellLabel->
  "Out[124]=",ExpressionUUID->"b9b27d3b-e490-4ad3-83fc-e2a4e042dce9"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"base", "=", "\"\<MQTT\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"input", "=", 
  RowBox[{"base", "<>", "\"\</input\>\""}]}], "\[IndentingNewLine]", 
 RowBox[{"output", "=", 
  RowBox[{"base", "<>", "\"\</output\>\""}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"buffer", "=", 
    RowBox[{"base", "<>", "\"\</buffer\>\""}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"NoneTrue", "[", 
     RowBox[{
      RowBox[{"CloudExpressions", "[", "]"}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"FileNameTake", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"FullForm", "[", "#", "]"}], "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"7", ",", 
            RowBox[{"-", "1"}]}], "}"}]}], "]"}], "\[Equal]", "buffer"}], 
       "&"}]}], "]"}], ",", "\[IndentingNewLine]", 
    RowBox[{"ce", "=", 
     RowBox[{"CreateCloudExpression", "[", 
      RowBox[{
       RowBox[{"<|", "|>"}], ",", "buffer"}], "]"}]}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"ce", "=", 
      RowBox[{"CloudExpression", "[", "buffer", "]"}]}], ";", "  ", 
     RowBox[{"Put", "[", 
      RowBox[{
       RowBox[{"<|", "|>"}], ",", "ce"}], "]"}], ";"}]}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SetOptions", "[", 
    RowBox[{"ce", ",", 
     RowBox[{"PartProtection", "\[Rule]", "None"}]}], "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"inputURL", "=", 
    RowBox[{
     RowBox[{"CloudPublish", "[", " ", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"APIFunction", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"\"\<ts\>\"", "\[Rule]", "Integer"}], ",", 
           RowBox[{"\"\<sa\>\"", " ", "\[Rule]", "Integer"}], ",", 
           RowBox[{"\"\<ra\>\"", "\[Rule]", "Integer"}], ",", 
           RowBox[{"\"\<type\>\"", "\[Rule]", "String"}], ",", 
           RowBox[{"\"\<payload\>\"", "\[Rule]", "String"}], ",", 
           RowBox[{"\"\<sig\>\"", "\[Rule]", "String"}]}], "}"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Module", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"net", "=", 
              RowBox[{"ToString", "@", 
               RowBox[{"IntegerPart", "[", 
                RowBox[{"#ra", "/", "1000"}], "]"}]}]}], "}"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"pack", "=", 
              RowBox[{"{", 
               RowBox[{
               "#ts", ",", "#sa", ",", "#ra", ",", "#type", ",", "#payload", 
                ",", "#sig"}], "}"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"KeyExistsQ", "[", 
                RowBox[{"ce", ",", "net"}], "]"}], ",", 
               RowBox[{"AppendTo", "[", 
                RowBox[{
                 RowBox[{"ce", "[", "net", "]"}], ",", "pack"}], "]"}], ",", 
               RowBox[{"AssociateTo", "[", 
                RowBox[{"ce", ",", 
                 RowBox[{"net", "\[Rule]", 
                  RowBox[{"{", "pack", "}"}]}]}], "]"}]}], "]"}], ";", " ", 
             "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Length", "@", 
                 RowBox[{"ce", "[", "net", "]"}]}], ">", "3"}], ",", 
               RowBox[{
                RowBox[{"ce", "[", 
                 RowBox[{"net", ",", "1"}], "]"}], "=."}]}], "]"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"HTTPResponse", "[", "200", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], "&"}]}], "\[IndentingNewLine]", " ", 
        "]"}], "\[IndentingNewLine]", ",", "input"}], "]"}], "[", 
     RowBox[{"[", "1", "]"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"outputURL", "=", 
   RowBox[{
    RowBox[{"CloudPublish", "[", " ", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"APIFunction", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\"\<net\>\"", " ", "\[Rule]", "String"}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Module", "[", 
          RowBox[{
           RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"KeyExistsQ", "[", 
                RowBox[{"ce", ",", "#net"}], "]"}], "&&", " ", 
               RowBox[{
                RowBox[{"Length", "@", 
                 RowBox[{"ce", "[", "#net", "]"}]}], ">", "0"}]}], ",", 
              RowBox[{
               RowBox[{"pack", "=", 
                RowBox[{"StringRiffle", "[", 
                 RowBox[{
                  RowBox[{"ToString", "/@", 
                   RowBox[{"ce", "[", 
                    RowBox[{"#net", ",", "1"}], "]"}]}], ",", "\"\<\\t\>\""}],
                  "]"}]}], ";", " ", 
               RowBox[{
                RowBox[{"ce", "[", 
                 RowBox[{"#net", ",", "1"}], "]"}], "=."}]}], " ", ",", 
              RowBox[{"pack", "=", "\"\<-\>\""}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"HTTPResponse", "[", "pack", "]"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}]}], "\[IndentingNewLine]", "]"}],
       "\[IndentingNewLine]", ",", "output"}], "]"}], "[", 
    RowBox[{"[", "1", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]"}], "Input",\

 CellChangeTimes->{{3.813407740576891*^9, 3.81340777428899*^9}, {
   3.8134092946878366`*^9, 3.813409348370501*^9}, {3.813431827801035*^9, 
   3.8134318398676367`*^9}, {3.813431890141636*^9, 3.8134320000359077`*^9}, {
   3.813433401621141*^9, 3.8134334999258623`*^9}, {3.813433739245871*^9, 
   3.81343377314067*^9}, {3.813433832350192*^9, 3.813433927284051*^9}, {
   3.813434023996923*^9, 3.813434037565111*^9}, {3.813434142055077*^9, 
   3.8134341489499207`*^9}, {3.8134342375189466`*^9, 3.81343426438041*^9}, {
   3.813434974397841*^9, 3.813434974779819*^9}, {3.813435006630213*^9, 
   3.8134350411577806`*^9}, {3.813435121239046*^9, 3.813435138357765*^9}, {
   3.813435249326851*^9, 3.8134352515959597`*^9}, {3.813435512030077*^9, 
   3.813435557972454*^9}, {3.813435592989604*^9, 3.813435593358143*^9}, {
   3.8134356652235193`*^9, 3.813435666750164*^9}, {3.813435723421261*^9, 
   3.8134357432073107`*^9}, {3.813435874216035*^9, 3.813435916029303*^9}, {
   3.813435952565811*^9, 3.8134360126302967`*^9}, {3.813436094734171*^9, 
   3.813436118134123*^9}, {3.813436203095565*^9, 3.813436347081067*^9}, {
   3.8134372852703333`*^9, 3.813437287438999*^9}, {3.813437346550713*^9, 
   3.813437377006228*^9}, {3.813437425111711*^9, 3.813437513607101*^9}, {
   3.813437700192482*^9, 3.8134378102869673`*^9}, {3.8134379105846367`*^9, 
   3.8134379409514847`*^9}, {3.813438262263783*^9, 3.813438263023061*^9}, {
   3.813439040144218*^9, 3.813439040966075*^9}, {3.813439079305949*^9, 
   3.813439080296382*^9}, {3.813440215128047*^9, 3.8134402559877987`*^9}, {
   3.813440376149371*^9, 3.813440430607224*^9}, {3.813440921712854*^9, 
   3.813440983827484*^9}, {3.813441046903973*^9, 3.813441069926338*^9}, {
   3.813441149801291*^9, 3.8134411745905113`*^9}, {3.813441204887763*^9, 
   3.813441207479892*^9}, {3.813442609168613*^9, 3.813442623653369*^9}, {
   3.813442751978578*^9, 3.813442823184291*^9}, {3.813442879097109*^9, 
   3.813442921607698*^9}, {3.813442987705208*^9, 3.813443008990981*^9}, {
   3.8134430487208023`*^9, 3.813443061521196*^9}, {3.813443294874905*^9, 
   3.81344329557381*^9}, {3.8134433562255077`*^9, 3.813443373997908*^9}, {
   3.813443483802477*^9, 3.813443497859417*^9}, {3.813443595048571*^9, 
   3.813443600201066*^9}, {3.81344363068336*^9, 3.8134436383529863`*^9}, {
   3.8134437462266273`*^9, 3.813443811176312*^9}, {3.813443863681294*^9, 
   3.813443866441402*^9}, {3.813444114496553*^9, 3.8134441363906116`*^9}, {
   3.813444179823105*^9, 3.8134442333198233`*^9}, {3.813444393752142*^9, 
   3.813444452879715*^9}, {3.8134444880308733`*^9, 3.813444613585225*^9}, {
   3.813444678120717*^9, 3.813444681058401*^9}, {3.813444765977738*^9, 
   3.813444783103239*^9}, {3.813444823244502*^9, 3.8134448408800993`*^9}, {
   3.813444882024102*^9, 3.8134449743028193`*^9}, 3.813445016913238*^9, {
   3.8134451287916203`*^9, 3.813445184798192*^9}, {3.8134454668736143`*^9, 
   3.813445493367399*^9}, {3.813445524944695*^9, 3.813445556255391*^9}, {
   3.8134455869689493`*^9, 3.813445596783042*^9}, {3.813445756395746*^9, 
   3.813445756975422*^9}, {3.813445802515933*^9, 3.813445837951713*^9}, {
   3.813445938608865*^9, 3.813445945399604*^9}, {3.813445978651682*^9, 
   3.813445981818817*^9}, 3.813446059570725*^9, {3.81344609236414*^9, 
   3.813446117072196*^9}, 3.813446288272369*^9, {3.8134463223096943`*^9, 
   3.813446330322217*^9}, {3.8134464036384287`*^9, 3.813446407866226*^9}, {
   3.813446457548264*^9, 3.8134465345325813`*^9}, {3.813446570804908*^9, 
   3.8134466553919077`*^9}, {3.8134466979567413`*^9, 3.813446750447526*^9}, {
   3.813446809298154*^9, 3.813446813830763*^9}, {3.813446847316918*^9, 
   3.8134468773765717`*^9}, {3.8134469098518467`*^9, 3.813447050896431*^9}, {
   3.8134470895267687`*^9, 3.813447117304413*^9}, 3.8134486885731688`*^9, {
   3.8134487432495823`*^9, 3.813448814242701*^9}, {3.81344885072375*^9, 
   3.8134488539610853`*^9}, {3.813448909866292*^9, 3.8134489275665083`*^9}, {
   3.813449626956987*^9, 3.813449917633995*^9}, {3.813449948025015*^9, 
   3.813449972234294*^9}, {3.81345000601258*^9, 3.813450012011825*^9}, {
   3.81345006885398*^9, 3.8134500856419697`*^9}, {3.8134518169562473`*^9, 
   3.813451831255952*^9}, {3.813451908321851*^9, 3.8134519240097837`*^9}, {
   3.813451976664474*^9, 3.8134519960275793`*^9}, {3.8134520918444777`*^9, 
   3.8134521385962553`*^9}, {3.8134521705096817`*^9, 3.813452174108514*^9}, {
   3.813452220192852*^9, 3.813452221851489*^9}, {3.8134522768485518`*^9, 
   3.813452379976076*^9}, {3.813452413172426*^9, 3.813452416276506*^9}, {
   3.813452470777748*^9, 3.8134524919407*^9}, {3.81345278959906*^9, 
   3.813452790196072*^9}, {3.813452826359973*^9, 3.8134528448746767`*^9}, {
   3.813453016977124*^9, 3.813453028609901*^9}, {3.81345305909916*^9, 
   3.813453081378727*^9}, {3.813453162493614*^9, 3.813453192337932*^9}, {
   3.813453486837758*^9, 3.8134535289947863`*^9}, {3.813453585514962*^9, 
   3.8134535947707872`*^9}, {3.813453715067017*^9, 3.8134537438265047`*^9}, 
   3.813456680031702*^9, {3.813456840135741*^9, 3.813456887038954*^9}, {
   3.81345748771305*^9, 3.813457490158286*^9}, {3.8140038021229687`*^9, 
   3.814003803797627*^9}, 3.8140039544160767`*^9, {3.81400790291183*^9, 
   3.8140079058448563`*^9}, {3.814008493672411*^9, 3.814008494836318*^9}},
 CellLabel->
  "In[180]:=",ExpressionUUID->"0a993ee9-9b6e-49ee-9aee-5f9ebff5e8ee"],

Cell[BoxData["\<\"MQTT/input\"\>"], "Output",
 CellChangeTimes->{{3.813450072257251*^9, 3.81345008668216*^9}, {
   3.813451049950286*^9, 3.8134510664880867`*^9}, 3.8134518640444593`*^9, 
   3.813451912568355*^9, {3.813452102127294*^9, 3.8134522670132523`*^9}, {
   3.813452368191463*^9, 3.8134524169765778`*^9}, {3.813452471256024*^9, 
   3.813452492380761*^9}, 3.8134527906002893`*^9, 3.813452848791206*^9, 
   3.813453083783846*^9, 3.813453203931696*^9, 3.813453256377592*^9, 
   3.813453367876545*^9, 3.8134537486647673`*^9, 3.813456681423314*^9, 
   3.813456887847574*^9, 3.813457369309346*^9, 3.81345749082015*^9, 
   3.8140031629814157`*^9, 3.814003815162745*^9, 3.814003968034197*^9, 
   3.814006141681497*^9, 3.814007682690167*^9, 3.8140078307562437`*^9, {
   3.814007906497134*^9, 3.8140079121953697`*^9}, {3.814008489749604*^9, 
   3.814008498048025*^9}},
 CellLabel->
  "Out[181]=",ExpressionUUID->"87465208-5744-42a5-b136-e1aafe41238e"],

Cell[BoxData["\<\"MQTT/output\"\>"], "Output",
 CellChangeTimes->{{3.813450072257251*^9, 3.81345008668216*^9}, {
   3.813451049950286*^9, 3.8134510664880867`*^9}, 3.8134518640444593`*^9, 
   3.813451912568355*^9, {3.813452102127294*^9, 3.8134522670132523`*^9}, {
   3.813452368191463*^9, 3.8134524169765778`*^9}, {3.813452471256024*^9, 
   3.813452492380761*^9}, 3.8134527906002893`*^9, 3.813452848791206*^9, 
   3.813453083783846*^9, 3.813453203931696*^9, 3.813453256377592*^9, 
   3.813453367876545*^9, 3.8134537486647673`*^9, 3.813456681423314*^9, 
   3.813456887847574*^9, 3.813457369309346*^9, 3.81345749082015*^9, 
   3.8140031629814157`*^9, 3.814003815162745*^9, 3.814003968034197*^9, 
   3.814006141681497*^9, 3.814007682690167*^9, 3.8140078307562437`*^9, {
   3.814007906497134*^9, 3.8140079121953697`*^9}, {3.814008489749604*^9, 
   3.8140084980524178`*^9}},
 CellLabel->
  "Out[182]=",ExpressionUUID->"40a37572-8631-4cf7-ae3d-5878f30df442"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ce", "[", "]"}], "//", "Normal"}], "//", "TableForm"}]], "Input",
 CellChangeTimes->{{3.813432667804674*^9, 3.813432668618802*^9}, {
   3.813438063646099*^9, 3.813438097116786*^9}, {3.8134381903740664`*^9, 
   3.813438203728075*^9}, 3.813443694223237*^9, {3.8134490731795607`*^9, 
   3.813449079464828*^9}, {3.8140036188776693`*^9, 3.8140036205237427`*^9}, {
   3.814003758853547*^9, 3.814003760353156*^9}},
 CellLabel->
  "In[188]:=",ExpressionUUID->"4f78637e-f525-43d4-95c5-91508c4f907c"],

Cell[BoxData[
 TagBox[
  RowBox[{"{", "}"}],
  Function[BoxForm`e$, 
   TableForm[BoxForm`e$]]]], "Output",
 CellChangeTimes->{{3.814003761047718*^9, 3.814003777731565*^9}, {
   3.814003820721279*^9, 3.814003885114678*^9}, {3.814003917571396*^9, 
   3.814003933865322*^9}, {3.814003971248863*^9, 3.814003987785555*^9}, {
   3.814004216998156*^9, 3.814004220294529*^9}, {3.814004279759273*^9, 
   3.8140042917115307`*^9}, {3.814005341197434*^9, 3.814005365889318*^9}, {
   3.814005406812373*^9, 3.8140054196309423`*^9}, {3.814005529228055*^9, 
   3.814005551012535*^9}, 3.8140057553823843`*^9, {3.8140058173562183`*^9, 
   3.814005820730857*^9}, {3.814005892241819*^9, 3.814005935981141*^9}, {
   3.814006021100124*^9, 3.8140060579294043`*^9}, 3.814006111535254*^9, {
   3.814006154559268*^9, 3.81400616251758*^9}, 3.8140062029085093`*^9, {
   3.814006378993265*^9, 3.8140064229191008`*^9}, {3.814007639403262*^9, 
   3.8140076880394583`*^9}, 3.814007747313382*^9, 3.81400783463481*^9, 
   3.8140080240552397`*^9, 3.8140081412201757`*^9, 3.814008212722855*^9, 
   3.8140082744744987`*^9, {3.8140084861046677`*^9, 3.814008503112646*^9}},
 CellLabel->
  "Out[188]//TableForm=",ExpressionUUID->"f28a06af-3a56-4597-a195-\
f2228b758d35"]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"Put", "[", 
   RowBox[{
    RowBox[{"<|", "|>"}], ",", "ce"}], "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.814003549711535*^9, 3.814003601992613*^9}, 
   3.814003774878604*^9},
 CellLabel->
  "In[112]:=",ExpressionUUID->"eedc20fe-6fbd-4143-84d5-62ef7a5aa803"]
},
WindowSize->{1366, 704},
WindowMargins->{{0, Automatic}, {0, Automatic}},
Magnification:>0.9 Inherited,
FrontEndVersion->"12.0 for Linux x86 (64-bit) (April 8, 2019)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 509, 9, 29, "Input",ExpressionUUID->"e0937394-699c-4498-bd3b-9fc90a0741b8"],
Cell[CellGroupData[{
Cell[1092, 33, 121, 2, 29, "Input",ExpressionUUID->"4c406e40-5f01-4950-b1b8-727b8b2215e7"],
Cell[1216, 37, 339, 6, 33, "Output",ExpressionUUID->"b9b27d3b-e490-4ad3-83fc-e2a4e042dce9"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1592, 48, 11040, 219, 668, "Input",ExpressionUUID->"0a993ee9-9b6e-49ee-9aee-5f9ebff5e8ee"],
Cell[12635, 269, 948, 14, 33, "Output",ExpressionUUID->"87465208-5744-42a5-b136-e1aafe41238e"],
Cell[13586, 285, 951, 14, 33, "Output",ExpressionUUID->"40a37572-8631-4cf7-ae3d-5878f30df442"]
}, Open  ]],
Cell[CellGroupData[{
Cell[14574, 304, 537, 10, 29, "Input",ExpressionUUID->"4f78637e-f525-43d4-95c5-91508c4f907c"],
Cell[15114, 316, 1231, 21, 47, "Output",ExpressionUUID->"f28a06af-3a56-4597-a195-f2228b758d35"]
}, Open  ]],
Cell[16360, 340, 296, 8, 29, "Input",ExpressionUUID->"eedc20fe-6fbd-4143-84d5-62ef7a5aa803"]
}
]
*)

